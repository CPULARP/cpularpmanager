{% load show_tags i18n %}
{% if char.teaser and show_character.teaser %}
    <h2 class="c">{{ writing_fields.character.names.teaser }}</h2>
    <div class="teaser">{% show_char char.teaser run 1 %}</div>
{% endif %}
{% for fnum in char.factions %}
    {% with factions|get:fnum as fact %}
        {% if not fact.typ == 'fact' %}
            {% if show_faction and fact.number %}
                <h2 class="c">
                    <a href="{% url 'faction' event.slug run.number fact.number %}">{{ fact.name }}</a>
                </h2>
            {% else %}
                <h2>{{ fact.name }}</h2>
            {% endif %}
            {% if fact.teaser and show_faction.teaser %}
                {% show_char fact.teaser run 1 %}
            {% endif %}
        {% endif %}
    {% endwith %}
{% endfor %}
{% if features.questbuilder %}
    {% for tnum in char.traits %}
        {% with traits|get:tnum as f %}
            {% with quests|get:f.quest as quest %}
                {% if quest.open or check %}
                    {% with quest_types|get:f.typ as qt %}<h2>{{ qt.name }}</h2>{% endwith %}
                    <div class="go-inline">
                        <b>{% trans "Quest" %}: </b>{{ quest.name }}, <b>{% trans "Trait" %}: </b>{{ f.name }}
                    </div>
                    {% if quest.teaser and show_character.teaser %}
                        {% show_char quest.teaser run 1 %}
                    {% endif %}
                    {% if f.teaser and show_character.teaser %}
                        {% show_char f.teaser run 1 %}
                    {% endif %}
                    {% if f.open %}
                        <div class="go-inline">
                            <b>{% trans "Other characters" %}: </b>
                        </div>
                        {% for el in f.traits %}
                            {% if el.char and el.char.number != char.number %}
                                {{ el.name }} ( <a href="{% url 'character' slug run.number el.char.number %}">{{ el.char.name }}</a> )
                                <br />
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endif %}
            {% endwith %}
        {% endwith %}
    {% endfor %}
{% endif %}
