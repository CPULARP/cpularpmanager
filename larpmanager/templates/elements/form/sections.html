{% load i18n tz show_tags static %}
{% if form.load_templates %}
    {% with template_name=form.load_templates|stringformat:"s"|add:".html" %}
        {% include "elements/info/"|add:template_name %}
    {% endwith %}
{% endif %}
{% include "elements/form/informations.html" %}
{% if form.errors %}
    <p class="form_error">
        {% trans "Attention! The form contains errors in the fields" %}:&nbsp;
        {% for field in form.visible_fields %}
            {% if field.errors %}{{ field.label }}&nbsp;{% endif %}
        {% endfor %}
    </p>
{% endif %}
<form action="{{ request.path }}"
      method="post"
      enctype="multipart/form-data"
      id="main_form">
    {% csrf_token %}
    <div>
        <table class="mob no_csv">
            {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
            {% define "" as old_section %}
            {% for field in form.visible_fields %}
                {% if field.auto_id in form.sections %}
                    {% get_field form.sections field.auto_id as section %}
                    {% if section != old_section %}
                    </table>
                </div>
                <h1>
                    <a href="#"
                       class="my_toggle section-link"
                       tog='sec_{{ section | slugify }}'>
                        {{ section | template_trans }}
                        <i class="fa-solid fa-chevron-down"></i>
                    </a>
                </h1>
                <div class="{% if not form.show_sections %}hide{% endif %} sec_{{ section | slugify }}">
                    {% if section in form.section_descriptions %}
                        {% get_field form.section_descriptions section as description %}
                        {{ description | safe }}
                    {% endif %}
                    <table class="mob no_csv">
                        {% define section as old_section %}
                    {% endif %}
                {% endif %}
                <tr id="{{ field.id_for_label }}_tr">
                    <th>
                        <label id="lbl_{{ field.id_for_label }}">{{ field.label }}</label>
                        {% if form.translate and field.id_for_label in form.translate %}
                            <br />
                            <br />
                            <a onclick="return translate('{{ field.id_for_label }}');">{% trans "Translate" %}</a>
                        {% endif %}
                    </th>
                    <td>
                        {% if field.errors %}{{ field.errors }}{% endif %}
                        {% if form.translate and field.id_for_label in form.translate %}
                            <div class="orig hide">
                                <p>{% trans "Original" %}</p>
                                <div class="plot">{% get_field form.translate field.id_for_label %}</div>
                            </div>
                        {% endif %}
                        {% if form.details and field.id_for_label in form.details %}
                            {% autoescape off %}
                                <div class="plot">{% get_field_show_char form.details field.id_for_label run 1 %}</div>
                            {% endautoescape %}
                        {% endif %}
                        {% if form.show_link and field.id_for_label in form.show_link %}
                            <p>
                                <a href="#" class="my_toggle" tog="f_{{ field.id_for_label }}">{% trans "Show" %}</a>
                            </p>
                            <div style="display: none"
                                 class="hide hide_later f_{{ field.id_for_label }}">{{ field }}</div>
                        {% else %}
                            {{ field }}
                        {% endif %}
                        {% if field.help_text %}
                            <br>
                            <div class="helptext {% if field.field.widget.input_type == 'checkbox' %}helptext-checkbox{% endif %}">
                                {{ field.help_text | safe }}
                            </div>
                        {% endif %}
                        {% if field.auto_id in form.max_lengths %}
                            {% get_field form.max_lengths field.auto_id as args %}
                            {% if args.1 == "m" %}
                                <div class="helptext">
                                    {% trans "options" %}: <span class="count"></span> / {{ args.0 }}
                                </div>
                            {% else %}
                                <div class="helptext">
                                    {% trans "text length" %}: <span class="count"></span> / {{ args.0 }}
                                </div>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    <input type="submit" value="{% trans "Confirm" %}">
    <br />
    <br />
    {% if eid %}
        <p>{% trans "The form is saved every 30 seconds." %}</p>
    {% endif %}
    {% include "elements/form/delete.html" %}
</form>
